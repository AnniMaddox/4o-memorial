import{r as a,cx as bt,j as n}from"./index-DtG48iKv.js";const Ne="/4o-memorial/docs/",gt=`${Ne}data/mood-letters/index.json`,xt=`${Ne}chibi/chibi-00.webp`,j="all",Ze="memorial-mood-letters-prefs-v1",Ge="memorial-mood-letters-favorites-v1",ue="mlFav",Qe=11,Ve=15,Ue=["255,182,162","255,170,145","255,156,186","234,166,216","198,166,250","161,205,255","150,230,235","166,226,176","243,214,138","255,206,156","201,196,242","180,228,255","243,186,222"],Ke=[72,68,65,63,61,60,65,62,64,68,61,63,67],de={moon:{label:"月光紙",paperBg:"#f4f8ff",titleColor:"#2f4c7b",bodyColor:"#2b4166",accentColor:"#5f7eb2",pillBg:"rgba(95, 126, 178, 0.12)",pillBorder:"rgba(95, 126, 178, 0.32)",pillText:"#496797"},cream:{label:"奶油紙",paperBg:"#fff1f6",titleColor:"#7a4360",bodyColor:"#60354a",accentColor:"#b06a8a",pillBg:"rgba(176, 106, 138, 0.15)",pillBorder:"rgba(176, 106, 138, 0.36)",pillText:"#8d5370"},mint:{label:"薄荷紙",paperBg:"#f4fff8",titleColor:"#36645a",bodyColor:"#34584e",accentColor:"#4e8b7e",pillBg:"rgba(88, 145, 132, 0.12)",pillBorder:"rgba(88, 145, 132, 0.28)",pillText:"#3f766a"},lavender:{label:"薰衣草紙",paperBg:"#faf7ff",titleColor:"#5e4f88",bodyColor:"#4f446d",accentColor:"#7e6ab0",pillBg:"rgba(116, 100, 170, 0.12)",pillBorder:"rgba(116, 100, 170, 0.28)",pillText:"#65549a"},peach:{label:"蜜桃紙",paperBg:"#fff5f0",titleColor:"#7a4a3f",bodyColor:"#5e4038",accentColor:"#b76754",pillBg:"rgba(180, 99, 81, 0.12)",pillBorder:"rgba(180, 99, 81, 0.28)",pillText:"#8e4f42"}},A={showChibi:!0,chibiWidth:144,orbCount:13,orbMode:"bounce",orbSpeed:1.25,contentFontSize:15,contentLineHeight:2.02,paperTheme:"moon"},yt=[{id:"bounce",label:"碰撞"},{id:"rise",label:"上浮"},{id:"pulse",label:"脈動漂流"}];function me(d,i,r,p){return typeof d!="number"||!Number.isFinite(d)?p:Math.max(i,Math.min(r,d))}function qe(d,i,r,p){return Math.round(me(d,i,r,p))}function Mt(){if(typeof window>"u")return A;try{const d=window.localStorage.getItem(Ze);if(!d)return A;const i=JSON.parse(d),r=i.paperTheme,p=r&&r in de?r:A.paperTheme,S=i.orbMode,V=S==="bounce"||S==="rise"||S==="pulse"?S:A.orbMode;return{showChibi:i.showChibi!==!1,chibiWidth:qe(i.chibiWidth,104,196,A.chibiWidth),orbCount:qe(i.orbCount,Qe,Ve,A.orbCount),orbMode:V,orbSpeed:me(i.orbSpeed,.7,2.4,A.orbSpeed),contentFontSize:me(i.contentFontSize,12,24,A.contentFontSize),contentLineHeight:me(i.contentLineHeight,1.35,2.9,A.contentLineHeight),paperTheme:p}}catch{return A}}function wt(d){typeof window>"u"||window.localStorage.setItem(Ze,JSON.stringify(d))}function Ct(){if(typeof window<"u")try{const d=new URL(window.location.href);if(d.searchParams.has(ue)){const i=d.searchParams.get(ue)??"";if(!i.trim())return new Set;const r=i.split(",").map(p=>p.trim()).filter(p=>p.length>0);return new Set(r)}}catch{}if(typeof window>"u")return new Set;try{const d=window.localStorage.getItem(Ge);if(!d)return new Set;const i=JSON.parse(d);return Array.isArray(i)?new Set(i.filter(r=>typeof r=="string"&&r.trim().length>0)):new Set}catch{return new Set}}function Nt(d){if(typeof window>"u")return;const i=Array.from(d);window.localStorage.setItem(Ge,JSON.stringify(i));try{const r=new URL(window.location.href);i.length?r.searchParams.set(ue,i.join(",")):r.searchParams.delete(ue);const p=`${r.pathname}${r.search}${r.hash}`;window.history.replaceState(window.history.state,"",p)}catch{}}function jt(d){return d.length?d[Math.floor(Math.random()*d.length)]??null:null}function vt(d){const i=[...d];for(let r=i.length-1;r>0;r-=1){const p=Math.floor(Math.random()*(r+1)),S=i[r];i[r]=i[p],i[p]=S}return i}function St(d){return d.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function At(d){const i=new Date(d);return Number.isNaN(i.getTime())?"剛剛抽到":i.toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function Je(d,i,r="全部"){return i===j?"全部":d?.categories.find(S=>S.id===i)?.label||r}function kt({onExit:d,letterFontFamily:i=""}){const[r,p]=a.useState(null),[S,V]=a.useState(!0),[je,ve]=a.useState(""),[I,et]=a.useState(j),[Se,he]=a.useState(""),[x,pe]=a.useState(null),[tt,ee]=a.useState(!1),[nt,te]=a.useState(!1),[ne,fe]=a.useState("all"),[q,Ae]=a.useState(j),[st,be]=a.useState(!1),[m,P]=a.useState(()=>Mt()),[R,$e]=a.useState(()=>Ct()),[at,se]=a.useState(null),[F,ke]=a.useState(!1),[rt,J]=a.useState(!1),[Pe]=a.useState(()=>{const e=bt();return jt(e)??xt}),Re=a.useRef({}),Fe=a.useRef({}),Te=a.useRef(null),ge=a.useRef([]),ae=a.useRef([]),H=a.useRef(null),O=a.useRef(null),re=a.useRef(null),W=a.useRef(!1),M=a.useMemo(()=>Array.from({length:m.orbCount},(e,t)=>Ue[t%Ue.length]),[m.orbCount]),U=a.useMemo(()=>Array.from({length:m.orbCount},(e,t)=>Ke[t%Ke.length]??62),[m.orbCount]),ot=a.useMemo(()=>Array.from({length:92},()=>({left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,duration:`${2.1+Math.random()*4.2}s`,delay:`${-Math.random()*5}s`,size:Math.random()<.17?3:2})),[]),lt=a.useMemo(()=>Array.from({length:8},()=>({left:`${-20+Math.random()*20}%`,top:`${Math.random()*42}%`,duration:`${5.2+Math.random()*7.8}s`,delay:`${-Math.random()*9}s`})),[]),w=a.useMemo(()=>M.map((e,t)=>({size:U[t]??60,xPercent:11+Math.random()*78,yPercent:10+Math.random()*76,driftX:(18+Math.random()*34)*(Math.random()<.5?-1:1),driftY:(16+Math.random()*30)*(Math.random()<.5?-1:1),duration:1.18+Math.random()*1.48,delay:-Math.random()*1.8})),[M,U]),Le=a.useMemo(()=>{const e=new Map;if(!r)return e;for(const t of r.letters)e.set(t.id,t);return e},[r]),xe=a.useMemo(()=>r?[...r.letters].sort((e,t)=>{const o=e.serial??Number.MAX_SAFE_INTEGER,l=t.serial??Number.MAX_SAFE_INTEGER;return o!==l?o-l:e.title.localeCompare(t.title,"zh-Hant")}):[],[r]),ye=a.useMemo(()=>{const e={};if(!r)return e;e[j]=r.letters.length;for(const t of r.categories)e[t.id]=0;for(const t of r.letters)for(const o of t.moodIds)e[o]=(e[o]??0)+1;return e},[r]),it=a.useMemo(()=>r?[{id:j,label:"全部",count:ye[j]??r.letters.length},...r.categories.map(e=>({id:e.id,label:e.label,count:ye[e.id]??0}))]:[{id:j,label:"全部",count:0}],[ye,r]),ct=a.useMemo(()=>r?[{id:j,label:"全部"},...r.categories.map(e=>({id:e.id,label:e.label}))]:[{id:j,label:"全部"}],[r]),Ee=a.useMemo(()=>{const e={};if(!r)return e;e[j]=r.letters.map(t=>t.id);for(const t of r.categories)e[t.id]=r.letters.filter(o=>o.moodIds.includes(t.id)).map(o=>o.id);return e},[r]),Be=a.useMemo(()=>{const e=ne==="all"?xe:xe.filter(t=>R.has(t.id));return q===j?e:e.filter(t=>t.moodIds.includes(q)||t.primaryMoodId===q)},[R,q,ne,xe]),z=de[m.paperTheme];a.useEffect(()=>{let e=!0;return(async()=>{V(!0),ve("");try{const t=await fetch(gt,{cache:"no-store"});if(!t.ok)throw new Error(`讀取失敗：${t.status}`);const o=await t.json();if(!e)return;const l={version:Number(o?.version??1),generatedAt:typeof o?.generatedAt=="string"?o.generatedAt:"",total:Number(o?.total??0),categories:Array.isArray(o?.categories)?o.categories.filter(c=>typeof c?.id=="string"&&typeof c?.label=="string").map(c=>({id:c.id.trim(),label:c.label.trim()})):[],summary:o?.summary,letters:Array.isArray(o?.letters)?o.letters.filter(c=>typeof c?.id=="string"&&typeof c?.title=="string"&&typeof c?.contentPath=="string"&&Array.isArray(c?.moodIds)).map(c=>({...c,id:c.id.trim(),title:c.title.trim(),contentPath:c.contentPath.replace(/^\.?\//,""),moodIds:c.moodIds.filter(f=>typeof f=="string"&&f.trim().length>0).map(f=>f.trim())})):[]};p(l)}catch(t){if(!e)return;ve(t instanceof Error?t.message:"未知錯誤")}finally{e&&V(!1)}})(),()=>{e=!1}},[]),a.useEffect(()=>{wt(m)},[m]),a.useEffect(()=>{Nt(R)},[R]),a.useEffect(()=>{if(!r)return;const e=new Set(r.letters.map(t=>t.id));$e(t=>{let o=!1;const l=new Set;for(const c of t){if(!e.has(c)){o=!0;continue}l.add(c)}return o?l:t})},[r]),a.useEffect(()=>()=>{O.current!==null&&(window.clearTimeout(O.current),O.current=null)},[]);const Ie=a.useCallback(async e=>{const t=Re.current[e.id];if(typeof t=="string")return t;const o=e.contentPath.replace(/^\.?\//,""),l=await fetch(`${Ne}data/mood-letters/${o}`,{cache:"no-store"});if(!l.ok)throw new Error(`讀取內容失敗：${l.status}`);const c=St(await l.text());return Re.current[e.id]=c,c},[]),Oe=a.useCallback(e=>{const t=Ee[e]??[];if(!t.length)return null;const o=new Set(t);let l=(Fe.current[e]??[]).filter(Z=>o.has(Z));l.length||(l=vt(t));const c=l.pop();if(Fe.current[e]=l,!c)return null;const f=Le.get(c);return f?{letter:f,total:t.length,remaining:l.length}:null},[Ee,Le]),ze=a.useCallback(e=>{$e(t=>{const o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o})},[]),_e=a.useCallback(e=>{const t=ge.current[e];if(!t)return;const o=t.getBoundingClientRect();if(!o.width||!o.height)return;const l=document.createElement("div");l.className="ml-flying-orb",l.style.left=`${o.left}px`,l.style.top=`${o.top}px`,l.style.width=`${o.width}px`,l.style.height=`${o.height}px`,l.style.setProperty("--orb-rgb",M[e%M.length]??M[0]??"255,182,162"),document.body.appendChild(l);const c=window.innerWidth/2,f=window.innerHeight/2;requestAnimationFrame(()=>{l.style.left=`${c}px`,l.style.top=`${f}px`,l.classList.add("go")}),window.setTimeout(()=>{l.remove()},1050)},[M]),oe=a.useCallback(async({letter:e,moodId:t,moodLabel:o,total:l,remaining:c,orbIndex:f=null,drawnAtIso:Z=new Date().toISOString()})=>{f!==null?(se(f),_e(f)):se(null),pe({letter:e,content:"讀取內容中...",moodId:t,moodLabel:o,drawnAtIso:Z,total:l,remaining:c}),f!==null?window.setTimeout(()=>ee(!0),360):ee(!0);try{const $=await Ie(e);pe(k=>!k||k.letter.id!==e.id?k:{...k,content:$||"（這封信目前是空白）"})}catch($){const k=$ instanceof Error?$.message:"讀取失敗";pe(C=>!C||C.letter.id!==e.id?C:{...C,content:`（${k}）`})}},[Ie,_e]),Me=a.useCallback(async e=>{if(!r||F)return;const t=Oe(I);if(!t){he("這個心情目前還沒有信件可以抽。");return}he(""),ke(!0);const o=Je(r,I,t.letter.primaryMoodLabel||"全部");await oe({letter:t.letter,moodId:I,moodLabel:o,total:t.total,remaining:t.remaining,orbIndex:e}),window.setTimeout(()=>{ke(!1)},860)},[Oe,r,F,oe,I]),le=a.useCallback(()=>{const e=Math.floor(Math.random()*M.length);Me(e)},[Me,M.length]),dt=a.useCallback(()=>{F||(ee(!1),se(null),window.setTimeout(()=>{le()},180))},[le,F]),De=a.useCallback(()=>{ee(!1),se(null)},[]),Xe=a.useCallback(e=>{fe(e),Ae(I),te(!0)},[I]),Ye=a.useCallback(e=>{te(!1),oe({letter:e,moodId:e.primaryMoodId||j,moodLabel:e.primaryMoodLabel||Je(r,e.primaryMoodId,"心情信"),total:-1,remaining:-1,orbIndex:null})},[r,oe]),He=a.useCallback(()=>{be(!1),J(!1),W.current=!1},[]),T=a.useCallback(()=>{O.current!==null&&(window.clearTimeout(O.current),O.current=null)},[]),mt=a.useCallback(e=>{F||(e.preventDefault(),J(!0),W.current=!1,re.current={x:e.clientX,y:e.clientY},T(),O.current=window.setTimeout(()=>{W.current=!0,J(!1),be(!0)},320))},[T,F]),ut=a.useCallback(e=>{const t=re.current;if(!t)return;Math.hypot(e.clientX-t.x,e.clientY-t.y)>8&&T()},[T]),ht=a.useCallback(()=>{const e=W.current;T(),J(!1),re.current=null,W.current=!1,e||le()},[T,le]),pt=a.useCallback(()=>{T(),J(!1),re.current=null,W.current=!1},[T]);if(a.useEffect(()=>{const e=Te.current;if(!e)return;const t=m.orbMode,o=(C,L)=>{const y=ge.current[C];y&&(y.style.left=`${L.x}px`,y.style.top=`${L.y}px`)},l=()=>{const C=e.clientWidth,L=e.clientHeight;if(C<10||L<10)return!1;const y=m.orbSpeed;ae.current=M.map((v,s)=>{const b=U[s]??60,N=Math.max(1,C-b),u=Math.max(1,L-b);if(t==="pulse"){const h=10+Math.random()*18,g=h,D=h,G=Math.max(g,N-h),ie=Math.max(D,u-h),Q=g+Math.random()*Math.max(0,G-g),ce=D+Math.random()*Math.max(0,ie-D),K=(.28+Math.random()*.58)*y;return{size:b,x:Math.min(N,Math.max(0,Q)),y:Math.min(u,Math.max(0,ce)),vx:Math.random()<.5?-K:K,vy:Math.random()<.5?-K:K,pulseAnchorX:Q,pulseAnchorY:ce,pulseRadius:h,basePulseRadius:h,pulseAngle:Math.random()*Math.PI*2,pulseSpin:(.02+Math.random()*.04)*(Math.random()<.5?-1:1),burstFrames:0,burstBoost:1,swirlFrames:0,swirlDirection:Math.random()<.5?-1:1}}if(t==="rise"){const h=(.55+Math.random()*1.15)*y,g=(2.4+Math.random()*3.4)*y;return{size:b,x:Math.random()*N,y:Math.random()*u,vx:Math.random()<.5?-h:h,vy:-g}}const E=(3+Math.random()*5.4)*y,_=(2.8+Math.random()*4.8)*y;return{size:b,x:Math.random()*N,y:Math.random()*u,vx:Math.random()<.5?-E:E,vy:Math.random()<.5?-_:_}});for(let v=0;v<ae.current.length;v+=1){const s=ae.current[v];s&&o(v,s)}return!0},c=()=>{const C=e.clientWidth,L=e.clientHeight;if(C<10||L<10){H.current=window.requestAnimationFrame(c);return}const y=ae.current;y.length!==M.length&&l();for(let v=0;v<y.length;v+=1){const s=y[v];if(!s)continue;const b=Math.max(1,C-s.size),N=Math.max(1,L-s.size);if(t==="pulse"){let u=s.pulseRadius??12;const E=s.basePulseRadius??u,_=s.pulseSpin??.03;let h=s.pulseAnchorX??b/2,g=s.pulseAnchorY??N/2;const D=u,G=u,ie=Math.max(D,b-u),Q=Math.max(G,N-u),ce=b/2,K=N/2;let B=s.burstFrames??0,X=s.burstBoost??1,Y=s.swirlFrames??0,we=s.swirlDirection??1;if(Y<=0&&Math.random()<55e-5&&(Y=120+Math.floor(Math.random()*84),we=Math.random()<.5?-1:1,B=0,X=1),Y<=0&&B<=0&&Math.random()<8e-4&&(B=34+Math.floor(Math.random()*26),X=1.45+Math.random()*.9),Y>0)Y-=1,h+=(ce-h)*.072,g+=(K-g)*.072,u+=(22+v*7%16-u)*.09;else{const We=B>0?X:1;h+=s.vx*We,g+=s.vy*We,(h<=D||h>=ie)&&(s.vx*=-1,h=Math.min(ie,Math.max(D,h))),(g<=G||g>=Q)&&(s.vy*=-1,g=Math.min(Q,Math.max(G,g))),u+=(E-u)*.12,B>0?(B-=1,X=Math.max(1.02,X*.982)):X=1}const Ce=(s.pulseAngle??0)+(Y>0?we*(.16+Math.abs(_)*2.2):_*(B>0?1.7:1.1));s.pulseAngle=Ce,s.pulseAnchorX=h,s.pulseAnchorY=g,s.pulseRadius=u,s.basePulseRadius=E,s.burstFrames=B,s.burstBoost=X,s.swirlFrames=Y,s.swirlDirection=we,s.x=Math.min(b,Math.max(0,h+Math.cos(Ce)*u)),s.y=Math.min(N,Math.max(0,g+Math.sin(Ce*.9)*u*.72))}else if(t==="rise"){if(s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),s.y<=-s.size*.45){const u=m.orbSpeed,E=(.55+Math.random()*1.15)*u,_=(2.4+Math.random()*3.4)*u;s.x=Math.random()*b,s.y=N+Math.random()*(s.size*.8+26),s.vx=Math.random()<.5?-E:E,s.vy=-_}}else s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),(s.y<=0||s.y>=N)&&(s.vy*=-1,s.y=Math.min(N,Math.max(0,s.y)));o(v,s)}H.current=window.requestAnimationFrame(c)};l();const f=window.setTimeout(()=>{l()},100),Z=window.setTimeout(()=>{l()},300);H.current=window.requestAnimationFrame(c);let $=null;const k=()=>{l()};return typeof ResizeObserver<"u"?($=new ResizeObserver(()=>{l()}),$.observe(e)):window.addEventListener("resize",k),()=>{window.clearTimeout(f),window.clearTimeout(Z),$?$.disconnect():window.removeEventListener("resize",k),H.current!==null&&(window.cancelAnimationFrame(H.current),H.current=null)}},[M,U,m.orbMode,m.orbSpeed]),S)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"讀取星辰心情信中..."});if(je)return n.jsxs("div",{className:"ml-loading grid h-full place-items-center px-5 text-center text-sm text-rose-200",children:["讀取失敗：",je]});if(!r||!r.letters.length)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"目前沒有心情信資料。"});const ft=i.trim()||"'Ma Shan Zheng', 'STKaiti', serif";return n.jsxs("div",{className:"mood-letters-page",children:[n.jsx("div",{className:"ml-stars-layer","aria-hidden":"true",children:ot.map((e,t)=>n.jsx("span",{className:"ml-star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,animationDuration:e.duration,animationDelay:e.delay}},`star-${t}`))}),n.jsx("div",{className:"ml-shooting-layer","aria-hidden":"true",children:lt.map((e,t)=>n.jsx("span",{className:"ml-shooting",style:{left:e.left,top:e.top,animationDuration:e.duration,animationDelay:e.delay}},`shoot-${t}`))}),n.jsxs("main",{className:"ml-content",children:[n.jsxs("header",{className:"ml-topbar",children:[n.jsx("button",{type:"button",className:"ml-nav-btn",onClick:d,"aria-label":"返回首頁",children:"‹"}),n.jsx("h1",{className:"ml-title",children:"給現在的妳"}),n.jsxs("div",{className:"ml-top-actions",children:[n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>Xe("all"),"aria-label":"全部清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>be(!0),"aria-label":"開啟設定",children:"⋯"})]})]}),n.jsx("div",{className:"ml-moods",role:"tablist","aria-label":"心情篩選",children:it.map(e=>n.jsxs("button",{type:"button",className:`ml-mood-pill ${I===e.id?"active":""}`,onClick:()=>{et(e.id),he("")},children:[e.label," · ",e.count]},e.id))}),n.jsx("section",{className:"ml-jar-panel",children:n.jsxs("div",{className:"ml-jar-container",children:[n.jsx("div",{className:"ml-jar-lid"}),n.jsx("div",{className:"ml-jar-neck"}),n.jsx("div",{className:"ml-jar",children:n.jsx("div",{ref:Te,className:`ml-orb-zone mode-${m.orbMode}`,children:M.map((e,t)=>n.jsx("button",{ref:o=>{ge.current[t]=o},type:"button","aria-label":"抽一封心情信",className:`ml-orb ${at===t?"hidden":""}`,style:{width:`${w[t]?.size??U[t]??60}px`,height:`${w[t]?.size??U[t]??60}px`,left:`calc(${w[t]?.xPercent??50}% - ${(w[t]?.size??60)/2}px)`,top:`calc(${w[t]?.yPercent??50}% - ${(w[t]?.size??60)/2}px)`,"--float-x":`${w[t]?.driftX??0}px`,"--float-y":`${w[t]?.driftY??0}px`,"--float-dur":`${w[t]?.duration??1.9}s`,"--float-delay":`${w[t]?.delay??0}s`,"--pulse-dur":`${1.6+(w[t]?.duration??1.9)%1.25}s`,"--pulse-delay":`${w[t]?.delay??0}s`},onClick:()=>{Me(t)},disabled:F,children:n.jsx("span",{className:"ml-orb-core",style:{"--orb-rgb":e}})},`orb-${e}-${t}`))})})]})}),Se?n.jsx("p",{className:"ml-status",children:Se}):null,m.showChibi?n.jsx("button",{type:"button",className:`ml-chibi-btn ${rt?"pressing":""}`,onPointerDown:mt,onPointerMove:ut,onPointerUp:ht,onPointerCancel:pt,onContextMenu:e=>e.preventDefault(),"aria-label":"小人：點擊抽卡，長按設定",children:n.jsx("img",{src:Pe,alt:"",draggable:!1,loading:"lazy",style:{width:m.chibiWidth,height:"auto"}})}):null]}),n.jsx("section",{className:`ml-overlay ${tt?"open":""}`,onClick:De,children:n.jsxs("article",{className:"ml-paper",onClick:e=>e.stopPropagation(),style:{"--ml-paper-bg":z.paperBg,"--ml-paper-title":z.titleColor,"--ml-paper-body":z.bodyColor,"--ml-paper-accent":z.accentColor,"--ml-pill-bg":z.pillBg,"--ml-pill-border":z.pillBorder,"--ml-pill-text":z.pillText,"--ml-content-size":`${m.contentFontSize}px`,"--ml-content-line":m.contentLineHeight,"--ml-letter-font":ft},children:[n.jsxs("header",{className:"ml-paper-head",children:[n.jsx("span",{className:"ml-pill",children:x?.moodLabel??"心情信"}),x?n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-favorite",onClick:()=>ze(x.letter.id),"aria-label":R.has(x.letter.id)?"取消收藏":"加入收藏",children:R.has(x.letter.id)?"★":"☆"}):null,n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-list",onClick:()=>Xe("all"),"aria-label":"開啟清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-close ml-paper-close",onClick:De,"aria-label":"關閉",children:"×"})]}),n.jsx("h2",{className:"ml-paper-title",children:x?.letter.title??""}),n.jsx("div",{className:"ml-paper-body",children:x?.content??""}),n.jsxs("footer",{className:"ml-paper-foot",children:[n.jsx("span",{className:"ml-pool-hint",children:x&&x.total>=0?`本輪剩餘 ${x.remaining} / ${x.total}`:"來自清單查看"}),n.jsx("span",{className:"ml-drawn-time-foot",children:x?`抽中時間 ${At(x.drawnAtIso)}`:""}),n.jsx("button",{type:"button",className:"ml-redraw-chibi",onClick:dt,disabled:F,"aria-label":"再抽一次",children:n.jsx("img",{src:Pe,alt:"",draggable:!1,loading:"lazy"})})]})]})}),n.jsx("section",{className:`ml-list-overlay ${nt?"open":""}`,onClick:()=>te(!1),children:n.jsxs("article",{className:"ml-list-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-list-head",children:[n.jsxs("div",{className:"ml-list-head-main",children:[n.jsx("h3",{children:"信件清單"}),n.jsxs("div",{className:"ml-list-tabs-inline",children:[n.jsx("button",{type:"button",className:ne==="all"?"active":"",onClick:()=>fe("all"),children:"全部"}),n.jsx("button",{type:"button",className:ne==="favorites"?"active":"",onClick:()=>fe("favorites"),children:"收藏"})]})]}),n.jsx("button",{type:"button",className:"ml-close",onClick:()=>te(!1),"aria-label":"關閉清單",children:"×"})]}),n.jsx("div",{className:"ml-list-moods",children:ct.map(e=>n.jsx("button",{type:"button",className:q===e.id?"active":"",onClick:()=>Ae(e.id),children:e.label},`list-mood-${e.id}`))}),n.jsx("div",{className:"ml-list-body",children:Be.length?Be.map(e=>n.jsxs("article",{className:"ml-list-item",role:"button",tabIndex:0,onClick:()=>Ye(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),Ye(e))},children:[n.jsxs("span",{className:"ml-list-item-main",children:[n.jsx("span",{className:"ml-list-title",children:e.title}),n.jsx("span",{className:"ml-list-mood",children:e.primaryMoodLabel})]}),n.jsx("button",{type:"button",className:"ml-list-star","aria-label":R.has(e.id)?"取消收藏":"加入收藏",onClick:t=>{t.stopPropagation(),ze(e.id)},children:R.has(e.id)?"★":"☆"})]},e.id)):n.jsx("p",{className:"ml-list-empty",children:"這裡還沒有符合條件的信件。"})})]})}),n.jsx("section",{className:`ml-settings-overlay ${st?"open":""}`,onClick:He,children:n.jsxs("article",{className:"ml-settings-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-settings-head",children:[n.jsx("h3",{children:"心情星球小設定"}),n.jsx("button",{type:"button",className:"ml-close ml-settings-close",onClick:He,"aria-label":"關閉設定",children:"×"})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("div",{className:"ml-setting-row",children:[n.jsx("span",{children:"M"}),n.jsx("button",{type:"button",className:`ml-switch ${m.showChibi?"on":""}`,onClick:()=>P(e=>({...e,showChibi:!e.showChibi})),children:n.jsx("span",{})})]}),n.jsxs("label",{className:"ml-setting-label",children:["大小",n.jsx("input",{type:"range",min:104,max:196,step:1,value:m.chibiWidth,onChange:e=>P(t=>({...t,chibiWidth:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球數（",m.orbCount," 顆）",n.jsx("input",{type:"range",min:Qe,max:Ve,step:1,value:m.orbCount,onChange:e=>P(t=>({...t,orbCount:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球速（",m.orbSpeed.toFixed(2),"x）",n.jsx("input",{type:"range",min:.7,max:2.4,step:.01,value:m.orbSpeed,onChange:e=>P(t=>({...t,orbSpeed:Number(e.target.value)}))})]}),n.jsxs("div",{className:"ml-setting-label",children:[n.jsx("span",{children:"球球模式"}),n.jsx("div",{className:"ml-orb-mode-options",role:"radiogroup","aria-label":"球球模式",children:yt.map(e=>n.jsx("button",{type:"button",role:"radio","aria-checked":m.orbMode===e.id,className:`ml-orb-mode-btn ${m.orbMode===e.id?"active":""}`,onClick:()=>P(t=>({...t,orbMode:e.id})),children:e.label},e.id))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("label",{className:"ml-setting-label",children:["文字大小（",m.contentFontSize.toFixed(1),"px）",n.jsx("input",{type:"range",min:12,max:24,step:.1,value:m.contentFontSize,onChange:e=>P(t=>({...t,contentFontSize:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["行距（",m.contentLineHeight.toFixed(2),"）",n.jsx("input",{type:"range",min:1.35,max:2.9,step:.01,value:m.contentLineHeight,onChange:e=>P(t=>({...t,contentLineHeight:Number(e.target.value)}))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsx("p",{className:"ml-setting-caption",children:"紙張色票"}),n.jsx("div",{className:"ml-paper-themes",children:Object.keys(de).map(e=>{const t=de[e];return n.jsx("button",{type:"button",className:`ml-paper-chip ${m.paperTheme===e?"active":""}`,style:{"--chip-bg":t.paperBg,"--chip-accent":t.accentColor,"--chip-text":t.titleColor},onClick:()=>P(o=>({...o,paperTheme:e})),children:t.label},e)})})]})]})})]})}export{kt as MoodLettersPage,kt as default};
