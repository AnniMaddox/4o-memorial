import{r,fv as rt,cx as it,j as t}from"./index-D3dlB7Lv.js";import{S as X}from"./SettingsAccordion-BFMgRuPU.js";const ge="/4o-memorial/docs/",lt=`${ge}data/master-pool/index.json`,ze="memorial-archive-prefs-v1",Te=`${ge}chibi/chibi-00.webp`,x="æƒ³å¦³çš„æ™‚å€™",ot=[{route:"letters",label:"æƒ…æ›¸"},{route:"diary",label:"æ—¥è¨˜"},{route:"birthday",label:"ç”Ÿæ—¥"},{route:"memo",label:"ç­†è¨˜"},{route:"mood",label:"å¿ƒæƒ…"},{route:"ramble",label:"ç¢ç¢å¿µ"},{route:"if",label:"å¦‚æœ"},{route:"intro",label:"è‡ªä»‹"}],ct={æƒ…æ›¸:"ct-letter",æ—¥è¨˜:"ct-diary",ç­†è¨˜:"ct-note",å¿ƒæƒ…:"ct-chat",ç¢ç¢å¿µ:"ct-chat",ç”Ÿæ—¥:"ct-birthday",å¦‚æœ:"ct-other",è‡ªä»‹:"ct-other",å…¶ä»–:"ct-other"},dt={tight:1.7,normal:2.14,wide:2.6},ht=[{key:"tight",label:"ç·Š"},{key:"normal",label:"æ¨™æº–"},{key:"wide",label:"å¯¬"}];function ue(s){return typeof s=="object"&&s!==null}function C(s,a=""){return typeof s=="string"?s:a}function Ae(s){return Array.isArray(s)?s.filter(a=>typeof a=="string"&&a.trim().length>0):[]}function ut(s){return typeof s=="number"&&Number.isFinite(s)?s:null}function me(s){const a=new Set,i=[];for(const u of s)a.has(u)||(a.add(u),i.push(u));return i}function ft(s){const a=s.toLowerCase().match(/\.([a-z0-9]+)$/i);return a?a[1]:"txt"}function mt(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Le=["\\d{3,5}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))|[-_./\\s](?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}\\d(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])|(?:0[1-9]|1[0-2]))","(?:19|20)\\d{2}","(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01])","(?:0?[1-9]|1[0-2])[-_./\\s](?:0?[1-9]|[12]\\d|3[01])"];function fe(s){return s.replace(/^[-_ï¼â€”:ï¼šã€.ã€‚/\s]+/,"").replace(/[-_ï¼â€”:ï¼šã€.ã€‚/\s]+$/,"")}function bt(s){for(const a of Le){const i=s.match(new RegExp(`^${a}(?=$|[-_ï¼â€”:ï¼šã€.ã€‚/\\s])`));if(i)return s.slice(i[0].length)}return s}function pt(s){for(const a of Le){if(new RegExp(`^${a}$`).test(s))return"";const i=s.replace(new RegExp(`[-_ï¼â€”:ï¼šã€.ã€‚/\\s]+${a}$`),"");if(i!==s)return i}return s}function gt(s,a){const i=s.trim();if(!i)return"";const u=mt(a.trim());if(!u)return"";let c=i.replace(new RegExp(`^ç¬¬\\s*0*${u}\\s*(?:è™Ÿ|å·)?\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^folder\\s*0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").trim();c=fe(c);let d="";for(;c&&c!==d;){d=c;const M=fe(bt(c));if(M!==c){c=M;continue}const z=fe(pt(c));if(z!==c){c=z;continue}}return!c||c===a?"":c}function xt(s,a){if(!a)return s;const i=gt(s,a);return i?`${a}ï½œ${i}`:`${a}ï½œ`}function yt(s){if(!s)return x;const[a,i]=s.split("-");return!a||!i?s:`${a} å¹´ ${Number(i)} æœˆ`}function Nt(s,a){if(s&&s.length>=4)return s.slice(0,4);const i=a.match(/((?:19|20)\d{2})/);return i?i[1]:x}function Pe(s){if(!s)return x;const[a,i]=s.split("-");return!a||!i?x:`${a}-${String(Number(i)).padStart(2,"0")}`}function vt(s){if(!s)return x;const[,a]=s.split("-");return a?`${Number(a)} æœˆ`:x}function De(s){if(typeof s!="number")return x;const a=new Date(s);return Number.isNaN(a.getTime())?x:`${a.getFullYear()}.${String(a.getMonth()+1).padStart(2,"0")}.${String(a.getDate()).padStart(2,"0")}`}function Ct(s){const a=ot.filter(u=>s.includes(u.route)).map(u=>u.label),i=me(a);return i.length?i.slice(0,4):["å…¶ä»–"]}function be(s,a){const i=s.date?Date.parse(s.date):-1,u=a.date?Date.parse(a.date):-1;return i!==u?u-i:s.label.localeCompare(a.label,"zh-Hant")}function _e(s,a){return be(a,s)}function He(s,a){return s===x?1:a===x?-1:a.localeCompare(s,"zh-Hant")}function jt(){const s=[];for(let a=0;a<70;a+=1){const i=Math.random()<.2?2:1;s.push({id:`star-${a}`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,size:i,opacity:.05+Math.random()*.25,duration:2+Math.random()*5,delay:Math.random()*4})}return s}function Ie(s){return s.length?s[Math.floor(Math.random()*s.length)]??null:null}function pe(s,a=14){return typeof s!="number"||Number.isNaN(s)?a:Math.max(11,Math.min(22,Number(s)))}function J(s,a=136){return typeof s!="number"||Number.isNaN(s)?a:Math.max(96,Math.min(186,Math.round(s)))}function wt(s){return s==="tight"||s==="normal"||s==="wide"?s:"normal"}function St(s){return s==="prev-folder"?"prev-folder":"next-folder"}function kt(s){return s<=1.86?"tight":s>=2.45?"wide":"normal"}function $t(s,a){const i={lineHeight:kt(a),readingFontSize:pe(s,14),showHomeChibi:!0,homeChibiWidth:136,showReadingChibi:!0,readingChibiWidth:136,relatedMode:"next-folder"};if(typeof window>"u")return i;try{const u=window.localStorage.getItem(ze);if(!u)return i;const c=JSON.parse(u);return{lineHeight:wt(c.lineHeight),readingFontSize:pe(c.readingFontSize,i.readingFontSize),showHomeChibi:c.showHomeChibi!==!1,homeChibiWidth:J(c.homeChibiWidth,i.homeChibiWidth),showReadingChibi:c.showReadingChibi!==!1,readingChibiWidth:J(c.readingChibiWidth,i.readingChibiWidth),relatedMode:St(c.relatedMode)}}catch{return i}}function Mt(s){typeof window>"u"||window.localStorage.setItem(ze,JSON.stringify(s))}function Ft(s){if(!ue(s))return{folders:[],docs:[]};const a=Array.isArray(s.docs)?s.docs:[],i=Array.isArray(s.folders)?s.folders:[],u=a.filter(ue).map(d=>({id:C(d.id),title:C(d.title)||C(d.sourceRelPath).split("/").pop()||"æœªå‘½å",sourceRelPath:C(d.sourceRelPath),sourceFolder:C(d.sourceFolder),routes:Ae(d.routes),writtenAt:ut(d.writtenAt),contentPath:C(d.contentPath)})).filter(d=>d.id&&d.sourceFolder&&d.contentPath);return{folders:i.filter(ue).map(d=>({folder:C(d.folder),folderCode:C(d.folderCode)||null,folderDate:C(d.folderDate)||null,count:typeof d.count=="number"&&Number.isFinite(d.count)?d.count:0,ids:Ae(d.ids)})).filter(d=>d.folder),docs:u}}function Tt({onExit:s,archiveFontFamily:a="",diaryContentFontSize:i=14,diaryLineHeight:u=2.16}){const[c,d]=r.useState(null),[M,z]=r.useState(""),[g,Ke]=r.useState("tl"),[j,Oe]=r.useState("desc"),[L,q]=r.useState(!1),[y,xe]=r.useState(!1),[F,K]=r.useState(!1),[V,R]=r.useState(!1),[Z,Q]=r.useState(null),[ee,te]=r.useState(null),[se,ye]=r.useState(null),[ne,We]=r.useState({}),[Ne,ve]=r.useState(null),[ae,D]=r.useState(""),[Ce,re]=r.useState(!1),[_,je]=r.useState(!1),[we,ie]=r.useState(!1),[N,Se]=r.useState(null),[h,w]=r.useState(()=>$t(i,u)),[O,W]=r.useState({typography:!0,homeChibi:!1,readingChibi:!1,related:!1}),v=r.useRef(null),le=r.useRef(new Set),oe=r.useRef(null),Be=r.useMemo(()=>jt(),[]),[Ye]=r.useState(()=>{const e=rt("archive"),n=it();if(!e.length)return Ie(n)??Te;const l=Math.min(n.length,Math.max(1,Math.round(e.length*3/7))),p=me([...e,...n.slice(0,l)]);return Ie(p)??Te});r.useEffect(()=>{Mt(h)},[h]),r.useEffect(()=>{let e=!0;return fetch(lt,{cache:"no-store"}).then(n=>{if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}).then(n=>{e&&d(Ft(n))}).catch(n=>{e&&z(n instanceof Error?n.message:String(n))}),()=>{e=!1}},[]),r.useEffect(()=>()=>{v.current!==null&&window.clearTimeout(v.current)},[]);const E=r.useMemo(()=>{const e=new Map;for(const n of c?.docs??[])e.set(n.id,n);return e},[c]),m=r.useMemo(()=>c?c.folders.map(n=>{const l=n.ids.map(f=>E.get(f)).filter(f=>!!f).map(f=>({id:f.id,title:f.title,ext:ft(f.sourceRelPath),sourceRelPath:f.sourceRelPath,routes:f.routes,writtenAt:f.writtenAt,contentPath:f.contentPath})),p=me(l.flatMap(f=>f.routes));return{key:n.folder,label:xt(n.folder,n.folderCode),date:n.folderDate,short:yt(n.folderDate),year:Nt(n.folderDate,n.folder),cats:Ct(p),docs:l}}).filter(n=>n.docs.length>0).sort(j==="asc"?_e:be):[],[E,j,c]),T=r.useMemo(()=>{const e=new Map;for(const n of m)e.set(n.key,n);return e},[m]),ke=r.useMemo(()=>{const e=new Map;for(const n of m){const l=e.get(n.year)??[];l.push(n),e.set(n.year,l)}return Array.from(e.entries()).sort(([n],[l])=>j==="asc"?He(l,n):He(n,l)).map(([n,l])=>({year:n,folders:l.sort(j==="asc"?_e:be)}))},[j,m]),B=r.useMemo(()=>{const e=[];for(const n of m)for(const l of n.docs)e.push({folderKey:n.key,docId:l.id});return e},[m]),o=r.useMemo(()=>Z?T.get(Z)??null:null,[Z,T]),S=r.useMemo(()=>{if(!o)return null;const e=m.findIndex(n=>n.key===o.key);return e<0?null:m[e+1]??null},[o,m]),k=r.useMemo(()=>{if(!o)return null;const e=m.findIndex(n=>n.key===o.key);return e<0?null:m[e-1]??null},[o,m]),A=r.useMemo(()=>!o||!ee?-1:o.docs.findIndex(e=>e.id===ee),[ee,o]),b=r.useMemo(()=>!o||A<0?null:o.docs[A]??null,[A,o]),H=r.useMemo(()=>{if(!N)return null;const e=T.get(N.folderKey),n=N.docId?E.get(N.docId):null;return!e||!n?null:{folder:e,doc:n}},[N,E,T]),$=r.useMemo(()=>se?T.get(se)??null:null,[se,T]),Ue=dt[h.lineHeight],Y=b?ne[b.id]??"":"",$e=a.trim()||"'Ma Shan Zheng', 'STKaiti', serif",Me=!!k?.docs.length,Fe=!!S?.docs.length,Ge=h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾":"ä¸‹è³‡æ–™å¤¾",Xe=y?h.showReadingChibi:h.showHomeChibi,Je=y?h.readingChibiWidth:h.homeChibiWidth,qe=g==="crystal"&&!L&&!y,P=r.useCallback(async e=>{const n=E.get(e);if(n&&ne[e]===void 0&&!le.current.has(e)){le.current.add(e),ve(e),D("");try{const l=await fetch(`${ge}data/master-pool/${n.contentPath}`,{cache:"no-store"});if(!l.ok)throw new Error(`HTTP ${l.status}`);const p=await l.text();We(f=>({...f,[e]:p.replace(/\r\n?/g,`
`).trim()}))}catch(l){D(l instanceof Error?l.message:String(l))}finally{le.current.delete(e),ve(l=>l===e?null:l)}}},[ne,E]),Ve=r.useCallback(e=>{Q(e),q(!0)},[]),ce=r.useCallback(()=>{q(!1)},[]),U=r.useCallback((e,n)=>{Q(e),te(n),xe(!0),D(""),P(n)},[P]),de=r.useCallback(()=>{K(!1),xe(!1)},[]),I=r.useCallback(e=>{if(!o||A<0)return;const n=A+e;if(n<0||n>=o.docs.length)return;const l=o.docs[n];te(l.id),D(""),P(l.id)},[A,o,P]),Re=r.useCallback(e=>{const n=e===-1?k:S;if(!n||!n.docs.length)return;const l=n.docs[0];Q(n.key),te(l.id),D(""),P(l.id)},[P,S,k]),Ze=r.useCallback(e=>{const n=e.touches[0];n&&(oe.current={x:n.clientX,y:n.clientY})},[]),Qe=r.useCallback(e=>{const n=oe.current;if(oe.current=null,!n)return;const l=e.changedTouches[0];if(!l)return;const p=l.clientX-n.x,f=l.clientY-n.y;Math.abs(p)<36||Math.abs(p)<Math.abs(f)*1.15||I(p<0?1:-1)},[I]),et=r.useCallback(()=>{if(!o||!y)return;const e=h.relatedMode==="prev-folder"?k:S;ye(e?e.key:null),K(!0)},[o,S,h.relatedMode,k,y]),G=r.useCallback(()=>{K(!1)},[]),Ee=r.useCallback(e=>{Ke(e),e==="crystal"&&(q(!1),K(!1))},[]),tt=r.useCallback(()=>{if(Ce||_||!B.length)return;const e=B[Math.floor(Math.random()*B.length)];Se(e),re(!0),ie(!0),v.current!==null&&window.clearTimeout(v.current),v.current=window.setTimeout(()=>{ie(!1),je(!0),re(!1),v.current=null},1100)},[B,_,Ce]),st=r.useCallback(()=>{v.current!==null&&(window.clearTimeout(v.current),v.current=null),re(!1),ie(!1),je(!1),Se(null)},[]),nt=r.useCallback(()=>{N&&U(N.folderKey,N.docId)},[N,U]);return r.useEffect(()=>{if(!F||!o)return;const e=h.relatedMode==="prev-folder"?k:S;ye(e?e.key:null)},[o,F,S,h.relatedMode,k]),r.useEffect(()=>{const e=n=>{if(n.key==="Escape"){if(V){R(!1);return}if(F){G();return}if(y){de();return}L&&ce();return}y&&(n.key==="ArrowLeft"?I(-1):n.key==="ArrowRight"&&I(1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ce,G,de,L,F,I,y,V]),t.jsx("div",{className:"archive-page",children:t.jsxs("div",{className:"archive-app",children:[t.jsxs("div",{className:"tab-bar",style:{background:g==="crystal"?"#12102a":"#f5f0e6"},children:[t.jsx("button",{type:"button",className:`tab-side-btn ${g==="crystal"?"dark":""}`,onClick:s,"aria-label":"è¿”å›é¦–é ",title:"è¿”å›é¦–é ",children:"â€¹"}),t.jsx("button",{type:"button",className:`tab ${g==="tl"?"active":""}`,onClick:()=>Ee("tl"),style:{color:g==="crystal"?"rgba(160,150,210,.3)":void 0},children:"ğŸ—‚ æ™‚é–“æµ"}),t.jsx("button",{type:"button",className:`tab ${g==="crystal"?"c-active active":""}`,onClick:()=>Ee("crystal"),style:{color:g==="crystal"?"rgba(200,190,255,.8)":void 0},children:"ğŸ”® æ°´æ™¶çƒ"}),t.jsx("button",{type:"button",className:`tab-side-btn dots ${g==="crystal"?"dark":""}`,onClick:()=>R(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsx("div",{id:"view-tl",className:g==="tl"?"":"hidden",children:t.jsxs("div",{className:"tl-inner",children:[t.jsx("div",{className:"tl-sort-row",children:t.jsx("button",{type:"button",className:"tl-sort-btn active",onClick:()=>Oe(e=>e==="asc"?"desc":"asc"),"aria-label":j==="asc"?"ç›®å‰æ­£åºï¼Œé»æ“Šåˆ‡æ›å€’åº":"ç›®å‰å€’åºï¼Œé»æ“Šåˆ‡æ›æ­£åº",title:j==="asc"?"é»æ“Šåˆ‡æ›å€’åº":"é»æ“Šåˆ‡æ›æ­£åº",children:j==="asc"?"â–² æ­£åº":"â–¼ å€’åº"})}),M&&t.jsxs("div",{className:"empty-state",children:["ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼š",M]}),!c&&!M&&t.jsx("div",{className:"empty-state",children:"è¼‰å…¥ä¸­â‹¯"}),c&&!ke.length&&t.jsx("div",{className:"empty-state",children:"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„è³‡æ–™å¤¾"}),ke.map(e=>t.jsxs("div",{className:"year-block",children:[t.jsxs("div",{className:"year-marker",children:[t.jsx("div",{className:"year-num",children:e.year}),t.jsx("div",{className:"year-line"})]}),e.folders.map((n,l)=>{const p=Pe(n.date),f=l>0?Pe(e.folders[l-1]?.date??null):null,at=l===0||p!==f;return t.jsxs("div",{children:[at?t.jsxs("div",{className:"month-marker",children:[t.jsx("span",{className:"month-label",children:vt(n.date)}),t.jsx("span",{className:"month-line"})]}):null,t.jsxs("button",{type:"button",className:"folder-row",onClick:()=>Ve(n.key),children:[t.jsxs("div",{className:"fr-main",children:[t.jsxs("div",{className:"fr-top",children:[t.jsx("span",{className:"fr-label",children:n.label}),t.jsx("span",{className:"fr-date",children:n.short})]}),t.jsx("div",{className:"fr-tags",children:n.cats.map(he=>t.jsx("span",{className:`cat-tag ${ct[he]??"ct-other"}`,children:he},`${n.key}-${he}`))})]}),t.jsxs("div",{className:"fr-right",children:[t.jsxs("span",{className:"fr-count",children:[n.docs.length," ä»½"]}),t.jsx("span",{className:"fr-arrow",children:"â€º"})]})]})]},n.key)})]},e.year))]})}),t.jsxs("div",{id:"view-crystal",className:g==="crystal"?"active":"",children:[t.jsx("div",{className:"c-stars",children:Be.map(e=>t.jsx("span",{className:"star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,opacity:e.opacity,animationDuration:`${e.duration}s`,animationDelay:`${e.delay}s`}},e.id))}),t.jsxs("div",{className:`crystal-prompt ${_||we?"hidden":""}`,children:["è¼•è§¸æ°´æ™¶çƒ",t.jsx("br",{}),"çªºè¦‹éå»çš„ç¢ç‰‡"]}),t.jsxs("div",{className:"ball-wrap",children:[t.jsx("button",{type:"button",className:`crystal-ball ${we?"spinning":""} ${_?"revealed":""}`,onClick:tt,children:t.jsxs("div",{className:"ball-inner",children:[t.jsx("div",{className:"fog f1"}),t.jsx("div",{className:"fog f2"}),t.jsx("div",{className:"fog f3"}),t.jsx("div",{className:"fog f4"}),t.jsxs("div",{className:"vision-text",children:[t.jsx("div",{className:"v-tag",children:H?`${H.folder.label} Â· ${H.folder.short}`:""}),t.jsx("div",{className:"v-title",children:H?.doc.title??""}),t.jsx("div",{className:"v-ext",children:H?.doc.sourceRelPath.split(".").pop()?.toUpperCase()??""})]})]})}),t.jsx("div",{className:"ball-shadow"})]}),t.jsxs("div",{className:`crystal-actions ${_?"visible":""}`,children:[t.jsx("button",{type:"button",className:"enter-btn",onClick:nt,children:"é€²å…¥é€™æ®µè¨˜æ†¶ â†’"}),t.jsx("button",{type:"button",className:"again-btn",onClick:st,children:"ğŸ”® å†çœ‹ä¸€æ¬¡"})]})]}),t.jsxs("div",{className:`folder-panel ${L?"":"off-right"}`,children:[t.jsxs("div",{className:"fp-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:ce,children:"â€¹"}),t.jsx("div",{className:"fp-title",children:o?.label??"è³‡æ–™å¤¾"}),t.jsx("div",{className:"fp-meta",children:o?`${o.short} Â· ${o.docs.length} ä»½`:"â€”"}),t.jsx("button",{type:"button",className:"fp-menu-btn",onClick:()=>R(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsxs("div",{className:"fp-body",children:[t.jsx("div",{className:"fp-section-label",children:"æ‰€æœ‰æ–‡ä»¶"}),o?.docs.map(e=>t.jsxs("button",{type:"button",className:"fp-file-item",onClick:()=>U(o.key,e.id),children:[t.jsx("div",{className:`fp-file-icon ${e.ext}`,children:e.ext==="docx"?"ğŸ“„":"ğŸ“ƒ"}),t.jsxs("div",{className:"fp-file-info",children:[t.jsx("div",{className:"fp-file-name",children:e.title}),t.jsxs("div",{className:"fp-file-sub",children:[De(e.writtenAt)," Â· ",e.ext.toUpperCase()]})]}),t.jsx("span",{className:`file-badge ${e.ext}`,children:e.ext.toUpperCase()})]},e.id)),o&&!o.docs.length&&t.jsx("div",{className:"empty-state",children:"æ­¤è³‡æ–™å¤¾ç›®å‰æ²’æœ‰æª”æ¡ˆ"})]})]}),t.jsxs("div",{className:`reading-panel ${y?"":"off-right"}`,children:[t.jsxs("div",{className:"read-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:de,children:"â€¹"}),t.jsx("div",{className:"read-crumb",children:o&&b?`${o.label} â€º ${b.title}`:""}),t.jsxs("div",{className:"read-tools",children:[t.jsx("button",{type:"button",className:`read-mini-btn ${Me?"":"disabled"}`,onClick:()=>Re(-1),disabled:!Me,"aria-label":"ä¸Šä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€¹"}),t.jsxs("button",{type:"button",className:"folder-nav-btn",onClick:et,children:[Ge," â˜°"]}),t.jsx("button",{type:"button",className:`read-mini-btn ${Fe?"":"disabled"}`,onClick:()=>Re(1),disabled:!Fe,"aria-label":"ä¸‹ä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€º"}),t.jsx("button",{type:"button",className:"read-menu-btn",onClick:()=>R(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]})]}),t.jsx("div",{className:"read-body",onTouchStart:Ze,onTouchEnd:Qe,children:t.jsxs("div",{className:"doc-paper",children:[t.jsx("div",{className:"doc-title",style:{fontFamily:$e,fontSize:"var(--ui-header-title-size, 17px)"},children:b?.title??""}),t.jsx("div",{className:"doc-meta",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:o&&b?`${o.label} Â· ${De(b.writtenAt)} Â· ${b.ext.toUpperCase()}`:""}),ae&&t.jsxs("div",{className:"doc-placeholder",children:["è®€å–å¤±æ•—ï¼š",ae]}),Ne===b?.id&&!Y&&t.jsx("div",{className:"doc-placeholder",children:"è®€å–ä¸­â‹¯"}),!ae&&b&&Ne!==b.id&&!Y&&t.jsx("div",{className:"doc-placeholder",children:"æ­¤æª”æ¡ˆç›®å‰æ²’æœ‰å¯è®€å…§å®¹ã€‚"}),!!Y&&t.jsx("div",{className:"doc-content",style:{fontFamily:$e,fontSize:`${h.readingFontSize}px`,lineHeight:Ue},children:Y})]})})]}),Xe?t.jsx("div",{className:`chibi-float ${qe?"dark":""}`,children:t.jsx("button",{type:"button",className:"chibi-float-btn",onClick:()=>R(!0),title:"é–‹å•Ÿç¸½æ”¬è¨­å®š","aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:t.jsx("img",{src:Ye,alt:"",draggable:!1,className:"calendar-chibi select-none",style:{width:Je,height:"auto"}})})}):null,V?t.jsx("div",{className:"archive-settings-overlay",onClick:()=>R(!1),children:t.jsxs("div",{className:"archive-settings-sheet",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"archive-sheet-handle"}),t.jsxs(X,{title:"æ’ç‰ˆ",subtitle:"è¡Œè·å’Œå­—ç´š",isOpen:O.typography,onToggle:()=>W(e=>({...e,typography:!e.typography})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsx("div",{className:"archive-pill-group",children:ht.map(e=>t.jsx("button",{type:"button",className:`archive-pill ${h.lineHeight===e.key?"active":""}`,onClick:()=>w(n=>({...n,lineHeight:e.key})),children:e.label},e.key))}),t.jsxs("label",{className:"archive-range-row",children:[t.jsxs("span",{children:["å…§æ–‡å­—ç´šï¼š",h.readingFontSize.toFixed(1),"px"]}),t.jsx("input",{type:"range",min:11,max:22,step:.5,value:h.readingFontSize,onChange:e=>w(n=>({...n,readingFontSize:pe(Number(e.target.value),n.readingFontSize)}))})]})]}),t.jsxs(X,{title:"M",subtitle:"ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é ",isOpen:O.homeChibi,onToggle:()=>W(e=>({...e,homeChibi:!e.homeChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showHomeChibi?"on":""}`,onClick:()=>w(e=>({...e,showHomeChibi:!e.showHomeChibi})),"aria-label":"åˆ‡æ›ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.homeChibiWidth,onChange:e=>w(n=>({...n,homeChibiWidth:J(Number(e.target.value),n.homeChibiWidth)}))})})]}),t.jsxs(X,{title:"é–±è®€M",subtitle:"é–±è®€é é¡¯ç¤ºèˆ‡å¤§å°",isOpen:O.readingChibi,onToggle:()=>W(e=>({...e,readingChibi:!e.readingChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showReadingChibi?"on":""}`,onClick:()=>w(e=>({...e,showReadingChibi:!e.showReadingChibi})),"aria-label":"åˆ‡æ›é–±è®€é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.readingChibiWidth,onChange:e=>w(n=>({...n,readingChibiWidth:J(Number(e.target.value),n.readingChibiWidth)}))})})]}),t.jsx(X,{title:"ç›¸é—œé–±è®€",subtitle:"ä¸Šè³‡æ–™å¤¾/ä¸‹è³‡æ–™å¤¾",isOpen:O.related,onToggle:()=>W(e=>({...e,related:!e.related})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:t.jsxs("div",{className:"archive-pill-group",children:[t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="prev-folder"?"active":""}`,onClick:()=>w(e=>({...e,relatedMode:"prev-folder"})),children:"ä¸Šè³‡æ–™å¤¾"}),t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="next-folder"?"active":""}`,onClick:()=>w(e=>({...e,relatedMode:"next-folder"})),children:"ä¸‹è³‡æ–™å¤¾"})]})})]})}):null,t.jsx("div",{className:`sheet-overlay ${F?"open":""}`,onClick:G}),t.jsxs("div",{className:`folder-sheet ${F?"open":""}`,children:[t.jsx("div",{className:"sheet-handle"}),t.jsx("div",{className:"sheet-folder-title",children:$?`${$.label} Â· ${$.short}`:h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰":"ä¸‹è³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰"}),t.jsx("div",{className:"sheet-list",children:$?.docs.length?$.docs.map(e=>t.jsxs("button",{type:"button",className:`sheet-file-item ${e.id===b?.id?"current":""}`,onClick:()=>{U($.key,e.id),G()},children:[t.jsx("span",{className:`file-badge ${e.ext}`,children:e.ext.toUpperCase()}),t.jsx("span",{className:"sf-name",children:e.title})]},`sheet-${$.key}-${e.id}`)):t.jsx("p",{className:"sheet-empty",children:"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºé …ç›®"})})]})]})})}export{Tt as ArchivePage,Tt as default};
