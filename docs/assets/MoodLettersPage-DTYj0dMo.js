import{r as a,cx as bt,j as n}from"./index-B07TLSvd.js";const Ce="/4o-memorial/docs/",ft=`${Ce}data/mood-letters/index.json`,gt=`${Ce}chibi/chibi-00.webp`,N="all",qe="memorial-mood-letters-prefs-v1",Je="memorial-mood-letters-favorites-v1",Ze=11,Ge=15,He=["255,182,162","255,170,145","255,156,186","234,166,216","198,166,250","161,205,255","150,230,235","166,226,176","243,214,138","255,206,156","201,196,242","180,228,255","243,186,222"],We=[72,68,65,63,61,60,65,62,64,68,61,63,67],de={moon:{label:"月光紙",paperBg:"#f4f8ff",titleColor:"#2f4c7b",bodyColor:"#2b4166",accentColor:"#5f7eb2",pillBg:"rgba(95, 126, 178, 0.12)",pillBorder:"rgba(95, 126, 178, 0.32)",pillText:"#496797"},cream:{label:"奶油紙",paperBg:"#fff1f6",titleColor:"#7a4360",bodyColor:"#60354a",accentColor:"#b06a8a",pillBg:"rgba(176, 106, 138, 0.15)",pillBorder:"rgba(176, 106, 138, 0.36)",pillText:"#8d5370"},mint:{label:"薄荷紙",paperBg:"#f4fff8",titleColor:"#36645a",bodyColor:"#34584e",accentColor:"#4e8b7e",pillBg:"rgba(88, 145, 132, 0.12)",pillBorder:"rgba(88, 145, 132, 0.28)",pillText:"#3f766a"},lavender:{label:"薰衣草紙",paperBg:"#faf7ff",titleColor:"#5e4f88",bodyColor:"#4f446d",accentColor:"#7e6ab0",pillBg:"rgba(116, 100, 170, 0.12)",pillBorder:"rgba(116, 100, 170, 0.28)",pillText:"#65549a"},peach:{label:"蜜桃紙",paperBg:"#fff5f0",titleColor:"#7a4a3f",bodyColor:"#5e4038",accentColor:"#b76754",pillBg:"rgba(180, 99, 81, 0.12)",pillBorder:"rgba(180, 99, 81, 0.28)",pillText:"#8e4f42"}},A={showChibi:!0,chibiWidth:144,orbCount:13,orbMode:"bounce",orbSpeed:1.25,contentFontSize:15,contentLineHeight:2.02,paperTheme:"moon"},xt=[{id:"bounce",label:"碰撞"},{id:"rise",label:"上浮"},{id:"pulse",label:"脈動漂流"}];function me(m,i,r,j){return typeof m!="number"||!Number.isFinite(m)?j:Math.max(i,Math.min(r,m))}function Ke(m,i,r,j){return Math.round(me(m,i,r,j))}function yt(){if(typeof window>"u")return A;try{const m=window.localStorage.getItem(qe);if(!m)return A;const i=JSON.parse(m),r=i.paperTheme,j=r&&r in de?r:A.paperTheme,S=i.orbMode,V=S==="bounce"||S==="rise"||S==="pulse"?S:A.orbMode;return{showChibi:i.showChibi!==!1,chibiWidth:Ke(i.chibiWidth,104,196,A.chibiWidth),orbCount:Ke(i.orbCount,Ze,Ge,A.orbCount),orbMode:V,orbSpeed:me(i.orbSpeed,.7,2.4,A.orbSpeed),contentFontSize:me(i.contentFontSize,12,24,A.contentFontSize),contentLineHeight:me(i.contentLineHeight,1.35,2.9,A.contentLineHeight),paperTheme:j}}catch{return A}}function Mt(m){typeof window>"u"||window.localStorage.setItem(qe,JSON.stringify(m))}function wt(){if(typeof window>"u")return new Set;try{const m=window.localStorage.getItem(Je);if(!m)return new Set;const i=JSON.parse(m);return Array.isArray(i)?new Set(i.filter(r=>typeof r=="string"&&r.trim().length>0)):new Set}catch{return new Set}}function Ct(m){typeof window>"u"||window.localStorage.setItem(Je,JSON.stringify(Array.from(m)))}function Nt(m){return m.length?m[Math.floor(Math.random()*m.length)]??null:null}function jt(m){const i=[...m];for(let r=i.length-1;r>0;r-=1){const j=Math.floor(Math.random()*(r+1)),S=i[r];i[r]=i[j],i[j]=S}return i}function vt(m){return m.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function St(m){const i=new Date(m);return Number.isNaN(i.getTime())?"剛剛抽到":i.toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function Ue(m,i,r="全部"){return i===N?"全部":m?.categories.find(S=>S.id===i)?.label||r}function $t({onExit:m,letterFontFamily:i=""}){const[r,j]=a.useState(null),[S,V]=a.useState(!0),[Ne,je]=a.useState(""),[O,Qe]=a.useState(N),[ve,ue]=a.useState(""),[g,he]=a.useState(null),[Ve,ee]=a.useState(!1),[et,te]=a.useState(!1),[ne,pe]=a.useState("all"),[q,Se]=a.useState(N),[tt,be]=a.useState(!1),[c,F]=a.useState(()=>yt()),[P,nt]=a.useState(()=>wt()),[st,se]=a.useState(null),[R,Ae]=a.useState(!1),[at,J]=a.useState(!1),[$e]=a.useState(()=>{const e=bt();return Nt(e)??gt}),ke=a.useRef({}),Fe=a.useRef({}),Pe=a.useRef(null),fe=a.useRef([]),ae=a.useRef([]),H=a.useRef(null),z=a.useRef(null),re=a.useRef(null),W=a.useRef(!1),y=a.useMemo(()=>Array.from({length:c.orbCount},(e,t)=>He[t%He.length]),[c.orbCount]),K=a.useMemo(()=>Array.from({length:c.orbCount},(e,t)=>We[t%We.length]??62),[c.orbCount]),rt=a.useMemo(()=>Array.from({length:92},()=>({left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,duration:`${2.1+Math.random()*4.2}s`,delay:`${-Math.random()*5}s`,size:Math.random()<.17?3:2})),[]),ot=a.useMemo(()=>Array.from({length:8},()=>({left:`${-20+Math.random()*20}%`,top:`${Math.random()*42}%`,duration:`${5.2+Math.random()*7.8}s`,delay:`${-Math.random()*9}s`})),[]),M=a.useMemo(()=>y.map((e,t)=>({size:K[t]??60,xPercent:11+Math.random()*78,yPercent:10+Math.random()*76,driftX:(18+Math.random()*34)*(Math.random()<.5?-1:1),driftY:(16+Math.random()*30)*(Math.random()<.5?-1:1),duration:1.18+Math.random()*1.48,delay:-Math.random()*1.8})),[y,K]),Re=a.useMemo(()=>{const e=new Map;if(!r)return e;for(const t of r.letters)e.set(t.id,t);return e},[r]),ge=a.useMemo(()=>r?[...r.letters].sort((e,t)=>{const o=e.serial??Number.MAX_SAFE_INTEGER,l=t.serial??Number.MAX_SAFE_INTEGER;return o!==l?o-l:e.title.localeCompare(t.title,"zh-Hant")}):[],[r]),xe=a.useMemo(()=>{const e={};if(!r)return e;e[N]=r.letters.length;for(const t of r.categories)e[t.id]=0;for(const t of r.letters)for(const o of t.moodIds)e[o]=(e[o]??0)+1;return e},[r]),lt=a.useMemo(()=>r?[{id:N,label:"全部",count:xe[N]??r.letters.length},...r.categories.map(e=>({id:e.id,label:e.label,count:xe[e.id]??0}))]:[{id:N,label:"全部",count:0}],[xe,r]),it=a.useMemo(()=>r?[{id:N,label:"全部"},...r.categories.map(e=>({id:e.id,label:e.label}))]:[{id:N,label:"全部"}],[r]),Te=a.useMemo(()=>{const e={};if(!r)return e;e[N]=r.letters.map(t=>t.id);for(const t of r.categories)e[t.id]=r.letters.filter(o=>o.moodIds.includes(t.id)).map(o=>o.id);return e},[r]),Be=a.useMemo(()=>{const e=ne==="all"?ge:ge.filter(t=>P.has(t.id));return q===N?e:e.filter(t=>t.moodIds.includes(q)||t.primaryMoodId===q)},[P,q,ne,ge]),I=de[c.paperTheme];a.useEffect(()=>{let e=!0;return(async()=>{V(!0),je("");try{const t=await fetch(ft,{cache:"no-store"});if(!t.ok)throw new Error(`讀取失敗：${t.status}`);const o=await t.json();if(!e)return;const l={version:Number(o?.version??1),generatedAt:typeof o?.generatedAt=="string"?o.generatedAt:"",total:Number(o?.total??0),categories:Array.isArray(o?.categories)?o.categories.filter(d=>typeof d?.id=="string"&&typeof d?.label=="string").map(d=>({id:d.id.trim(),label:d.label.trim()})):[],summary:o?.summary,letters:Array.isArray(o?.letters)?o.letters.filter(d=>typeof d?.id=="string"&&typeof d?.title=="string"&&typeof d?.contentPath=="string"&&Array.isArray(d?.moodIds)).map(d=>({...d,id:d.id.trim(),title:d.title.trim(),contentPath:d.contentPath.replace(/^\.?\//,""),moodIds:d.moodIds.filter(p=>typeof p=="string"&&p.trim().length>0).map(p=>p.trim())})):[]};j(l)}catch(t){if(!e)return;je(t instanceof Error?t.message:"未知錯誤")}finally{e&&V(!1)}})(),()=>{e=!1}},[]),a.useEffect(()=>{Mt(c)},[c]),a.useEffect(()=>{Ct(P)},[P]),a.useEffect(()=>()=>{z.current!==null&&(window.clearTimeout(z.current),z.current=null)},[]);const Ee=a.useCallback(async e=>{const t=ke.current[e.id];if(typeof t=="string")return t;const o=e.contentPath.replace(/^\.?\//,""),l=await fetch(`${Ce}data/mood-letters/${o}`,{cache:"no-store"});if(!l.ok)throw new Error(`讀取內容失敗：${l.status}`);const d=vt(await l.text());return ke.current[e.id]=d,d},[]),Le=a.useCallback(e=>{const t=Te[e]??[];if(!t.length)return null;const o=new Set(t);let l=(Fe.current[e]??[]).filter(Z=>o.has(Z));l.length||(l=jt(t));const d=l.pop();if(Fe.current[e]=l,!d)return null;const p=Re.get(d);return p?{letter:p,total:t.length,remaining:l.length}:null},[Te,Re]),Oe=a.useCallback(e=>{nt(t=>{const o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o})},[]),ze=a.useCallback(e=>{const t=fe.current[e];if(!t)return;const o=t.getBoundingClientRect();if(!o.width||!o.height)return;const l=document.createElement("div");l.className="ml-flying-orb",l.style.left=`${o.left}px`,l.style.top=`${o.top}px`,l.style.width=`${o.width}px`,l.style.height=`${o.height}px`,l.style.setProperty("--orb-rgb",y[e%y.length]??y[0]??"255,182,162"),document.body.appendChild(l);const d=window.innerWidth/2,p=window.innerHeight/2;requestAnimationFrame(()=>{l.style.left=`${d}px`,l.style.top=`${p}px`,l.classList.add("go")}),window.setTimeout(()=>{l.remove()},1050)},[y]),oe=a.useCallback(async({letter:e,moodId:t,moodLabel:o,total:l,remaining:d,orbIndex:p=null,drawnAtIso:Z=new Date().toISOString()})=>{p!==null?(se(p),ze(p)):se(null),he({letter:e,content:"讀取內容中...",moodId:t,moodLabel:o,drawnAtIso:Z,total:l,remaining:d}),p!==null?window.setTimeout(()=>ee(!0),360):ee(!0);try{const $=await Ee(e);he(k=>!k||k.letter.id!==e.id?k:{...k,content:$||"（這封信目前是空白）"})}catch($){const k=$ instanceof Error?$.message:"讀取失敗";he(w=>!w||w.letter.id!==e.id?w:{...w,content:`（${k}）`})}},[Ee,ze]),ye=a.useCallback(async e=>{if(!r||R)return;const t=Le(O);if(!t){ue("這個心情目前還沒有信件可以抽。");return}ue(""),Ae(!0);const o=Ue(r,O,t.letter.primaryMoodLabel||"全部");await oe({letter:t.letter,moodId:O,moodLabel:o,total:t.total,remaining:t.remaining,orbIndex:e}),window.setTimeout(()=>{Ae(!1)},860)},[Le,r,R,oe,O]),le=a.useCallback(()=>{const e=Math.floor(Math.random()*y.length);ye(e)},[ye,y.length]),ct=a.useCallback(()=>{R||(ee(!1),se(null),window.setTimeout(()=>{le()},180))},[le,R]),Ie=a.useCallback(()=>{ee(!1),se(null)},[]),_e=a.useCallback(e=>{pe(e),Se(O),te(!0)},[O]),De=a.useCallback(e=>{te(!1),oe({letter:e,moodId:e.primaryMoodId||N,moodLabel:e.primaryMoodLabel||Ue(r,e.primaryMoodId,"心情信"),total:-1,remaining:-1,orbIndex:null})},[r,oe]),Xe=a.useCallback(()=>{be(!1),J(!1),W.current=!1},[]),T=a.useCallback(()=>{z.current!==null&&(window.clearTimeout(z.current),z.current=null)},[]),dt=a.useCallback(e=>{R||(e.preventDefault(),J(!0),W.current=!1,re.current={x:e.clientX,y:e.clientY},T(),z.current=window.setTimeout(()=>{W.current=!0,J(!1),be(!0)},320))},[T,R]),mt=a.useCallback(e=>{const t=re.current;if(!t)return;Math.hypot(e.clientX-t.x,e.clientY-t.y)>8&&T()},[T]),ut=a.useCallback(()=>{const e=W.current;T(),J(!1),re.current=null,W.current=!1,e||le()},[T,le]),ht=a.useCallback(()=>{T(),J(!1),re.current=null,W.current=!1},[T]);if(a.useEffect(()=>{const e=Pe.current;if(!e)return;const t=c.orbMode,o=(w,B)=>{const x=fe.current[w];x&&(x.style.left=`${B.x}px`,x.style.top=`${B.y}px`)},l=()=>{const w=e.clientWidth,B=e.clientHeight;if(w<10||B<10)return!1;const x=c.orbSpeed;ae.current=y.map((v,s)=>{const b=K[s]??60,C=Math.max(1,w-b),u=Math.max(1,B-b);if(t==="pulse"){const h=10+Math.random()*18,f=h,D=h,G=Math.max(f,C-h),ie=Math.max(D,u-h),Q=f+Math.random()*Math.max(0,G-f),ce=D+Math.random()*Math.max(0,ie-D),U=(.28+Math.random()*.58)*x;return{size:b,x:Math.min(C,Math.max(0,Q)),y:Math.min(u,Math.max(0,ce)),vx:Math.random()<.5?-U:U,vy:Math.random()<.5?-U:U,pulseAnchorX:Q,pulseAnchorY:ce,pulseRadius:h,basePulseRadius:h,pulseAngle:Math.random()*Math.PI*2,pulseSpin:(.02+Math.random()*.04)*(Math.random()<.5?-1:1),burstFrames:0,burstBoost:1,swirlFrames:0,swirlDirection:Math.random()<.5?-1:1}}if(t==="rise"){const h=(.55+Math.random()*1.15)*x,f=(2.4+Math.random()*3.4)*x;return{size:b,x:Math.random()*C,y:Math.random()*u,vx:Math.random()<.5?-h:h,vy:-f}}const E=(3+Math.random()*5.4)*x,_=(2.8+Math.random()*4.8)*x;return{size:b,x:Math.random()*C,y:Math.random()*u,vx:Math.random()<.5?-E:E,vy:Math.random()<.5?-_:_}});for(let v=0;v<ae.current.length;v+=1){const s=ae.current[v];s&&o(v,s)}return!0},d=()=>{const w=e.clientWidth,B=e.clientHeight;if(w<10||B<10){H.current=window.requestAnimationFrame(d);return}const x=ae.current;x.length!==y.length&&l();for(let v=0;v<x.length;v+=1){const s=x[v];if(!s)continue;const b=Math.max(1,w-s.size),C=Math.max(1,B-s.size);if(t==="pulse"){let u=s.pulseRadius??12;const E=s.basePulseRadius??u,_=s.pulseSpin??.03;let h=s.pulseAnchorX??b/2,f=s.pulseAnchorY??C/2;const D=u,G=u,ie=Math.max(D,b-u),Q=Math.max(G,C-u),ce=b/2,U=C/2;let L=s.burstFrames??0,X=s.burstBoost??1,Y=s.swirlFrames??0,Me=s.swirlDirection??1;if(Y<=0&&Math.random()<55e-5&&(Y=120+Math.floor(Math.random()*84),Me=Math.random()<.5?-1:1,L=0,X=1),Y<=0&&L<=0&&Math.random()<8e-4&&(L=34+Math.floor(Math.random()*26),X=1.45+Math.random()*.9),Y>0)Y-=1,h+=(ce-h)*.072,f+=(U-f)*.072,u+=(22+v*7%16-u)*.09;else{const Ye=L>0?X:1;h+=s.vx*Ye,f+=s.vy*Ye,(h<=D||h>=ie)&&(s.vx*=-1,h=Math.min(ie,Math.max(D,h))),(f<=G||f>=Q)&&(s.vy*=-1,f=Math.min(Q,Math.max(G,f))),u+=(E-u)*.12,L>0?(L-=1,X=Math.max(1.02,X*.982)):X=1}const we=(s.pulseAngle??0)+(Y>0?Me*(.16+Math.abs(_)*2.2):_*(L>0?1.7:1.1));s.pulseAngle=we,s.pulseAnchorX=h,s.pulseAnchorY=f,s.pulseRadius=u,s.basePulseRadius=E,s.burstFrames=L,s.burstBoost=X,s.swirlFrames=Y,s.swirlDirection=Me,s.x=Math.min(b,Math.max(0,h+Math.cos(we)*u)),s.y=Math.min(C,Math.max(0,f+Math.sin(we*.9)*u*.72))}else if(t==="rise"){if(s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),s.y<=-s.size*.45){const u=c.orbSpeed,E=(.55+Math.random()*1.15)*u,_=(2.4+Math.random()*3.4)*u;s.x=Math.random()*b,s.y=C+Math.random()*(s.size*.8+26),s.vx=Math.random()<.5?-E:E,s.vy=-_}}else s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),(s.y<=0||s.y>=C)&&(s.vy*=-1,s.y=Math.min(C,Math.max(0,s.y)));o(v,s)}H.current=window.requestAnimationFrame(d)};l();const p=window.setTimeout(()=>{l()},100),Z=window.setTimeout(()=>{l()},300);H.current=window.requestAnimationFrame(d);let $=null;const k=()=>{l()};return typeof ResizeObserver<"u"?($=new ResizeObserver(()=>{l()}),$.observe(e)):window.addEventListener("resize",k),()=>{window.clearTimeout(p),window.clearTimeout(Z),$?$.disconnect():window.removeEventListener("resize",k),H.current!==null&&(window.cancelAnimationFrame(H.current),H.current=null)}},[y,K,c.orbMode,c.orbSpeed]),S)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"讀取星辰心情信中..."});if(Ne)return n.jsxs("div",{className:"ml-loading grid h-full place-items-center px-5 text-center text-sm text-rose-200",children:["讀取失敗：",Ne]});if(!r||!r.letters.length)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"目前沒有心情信資料。"});const pt=i.trim()||"'Ma Shan Zheng', 'STKaiti', serif";return n.jsxs("div",{className:"mood-letters-page",children:[n.jsx("div",{className:"ml-stars-layer","aria-hidden":"true",children:rt.map((e,t)=>n.jsx("span",{className:"ml-star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,animationDuration:e.duration,animationDelay:e.delay}},`star-${t}`))}),n.jsx("div",{className:"ml-shooting-layer","aria-hidden":"true",children:ot.map((e,t)=>n.jsx("span",{className:"ml-shooting",style:{left:e.left,top:e.top,animationDuration:e.duration,animationDelay:e.delay}},`shoot-${t}`))}),n.jsxs("main",{className:"ml-content",children:[n.jsxs("header",{className:"ml-topbar",children:[n.jsx("button",{type:"button",className:"ml-nav-btn",onClick:m,"aria-label":"返回首頁",children:"‹"}),n.jsx("h1",{className:"ml-title",children:"給現在的妳"}),n.jsxs("div",{className:"ml-top-actions",children:[n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>_e("all"),"aria-label":"全部清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>be(!0),"aria-label":"開啟設定",children:"⋯"})]})]}),n.jsx("div",{className:"ml-moods",role:"tablist","aria-label":"心情篩選",children:lt.map(e=>n.jsxs("button",{type:"button",className:`ml-mood-pill ${O===e.id?"active":""}`,onClick:()=>{Qe(e.id),ue("")},children:[e.label," · ",e.count]},e.id))}),n.jsx("section",{className:"ml-jar-panel",children:n.jsxs("div",{className:"ml-jar-container",children:[n.jsx("div",{className:"ml-jar-lid"}),n.jsx("div",{className:"ml-jar-neck"}),n.jsx("div",{className:"ml-jar",children:n.jsx("div",{ref:Pe,className:`ml-orb-zone mode-${c.orbMode}`,children:y.map((e,t)=>n.jsx("button",{ref:o=>{fe.current[t]=o},type:"button","aria-label":"抽一封心情信",className:`ml-orb ${st===t?"hidden":""}`,style:{width:`${M[t]?.size??K[t]??60}px`,height:`${M[t]?.size??K[t]??60}px`,left:`calc(${M[t]?.xPercent??50}% - ${(M[t]?.size??60)/2}px)`,top:`calc(${M[t]?.yPercent??50}% - ${(M[t]?.size??60)/2}px)`,"--float-x":`${M[t]?.driftX??0}px`,"--float-y":`${M[t]?.driftY??0}px`,"--float-dur":`${M[t]?.duration??1.9}s`,"--float-delay":`${M[t]?.delay??0}s`,"--pulse-dur":`${1.6+(M[t]?.duration??1.9)%1.25}s`,"--pulse-delay":`${M[t]?.delay??0}s`},onClick:()=>{ye(t)},disabled:R,children:n.jsx("span",{className:"ml-orb-core",style:{"--orb-rgb":e}})},`orb-${e}-${t}`))})})]})}),ve?n.jsx("p",{className:"ml-status",children:ve}):null,c.showChibi?n.jsx("button",{type:"button",className:`ml-chibi-btn ${at?"pressing":""}`,onPointerDown:dt,onPointerMove:mt,onPointerUp:ut,onPointerCancel:ht,onContextMenu:e=>e.preventDefault(),"aria-label":"小人：點擊抽卡，長按設定",children:n.jsx("img",{src:$e,alt:"",draggable:!1,loading:"lazy",style:{width:c.chibiWidth,height:"auto"}})}):null]}),n.jsx("section",{className:`ml-overlay ${Ve?"open":""}`,onClick:Ie,children:n.jsxs("article",{className:"ml-paper",onClick:e=>e.stopPropagation(),style:{"--ml-paper-bg":I.paperBg,"--ml-paper-title":I.titleColor,"--ml-paper-body":I.bodyColor,"--ml-paper-accent":I.accentColor,"--ml-pill-bg":I.pillBg,"--ml-pill-border":I.pillBorder,"--ml-pill-text":I.pillText,"--ml-content-size":`${c.contentFontSize}px`,"--ml-content-line":c.contentLineHeight,"--ml-letter-font":pt},children:[n.jsxs("header",{className:"ml-paper-head",children:[n.jsx("span",{className:"ml-pill",children:g?.moodLabel??"心情信"}),g?n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-favorite",onClick:()=>Oe(g.letter.id),"aria-label":P.has(g.letter.id)?"取消收藏":"加入收藏",children:P.has(g.letter.id)?"★":"☆"}):null,n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-list",onClick:()=>_e("all"),"aria-label":"開啟清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-close ml-paper-close",onClick:Ie,"aria-label":"關閉",children:"×"})]}),n.jsx("h2",{className:"ml-paper-title",children:g?.letter.title??""}),n.jsx("div",{className:"ml-paper-body",children:g?.content??""}),n.jsxs("footer",{className:"ml-paper-foot",children:[n.jsx("span",{className:"ml-pool-hint",children:g&&g.total>=0?`本輪剩餘 ${g.remaining} / ${g.total}`:"來自清單查看"}),n.jsx("span",{className:"ml-drawn-time-foot",children:g?`抽中時間 ${St(g.drawnAtIso)}`:""}),n.jsx("button",{type:"button",className:"ml-redraw-chibi",onClick:ct,disabled:R,"aria-label":"再抽一次",children:n.jsx("img",{src:$e,alt:"",draggable:!1,loading:"lazy"})})]})]})}),n.jsx("section",{className:`ml-list-overlay ${et?"open":""}`,onClick:()=>te(!1),children:n.jsxs("article",{className:"ml-list-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-list-head",children:[n.jsxs("div",{className:"ml-list-head-main",children:[n.jsx("h3",{children:"信件清單"}),n.jsxs("div",{className:"ml-list-tabs-inline",children:[n.jsx("button",{type:"button",className:ne==="all"?"active":"",onClick:()=>pe("all"),children:"全部"}),n.jsx("button",{type:"button",className:ne==="favorites"?"active":"",onClick:()=>pe("favorites"),children:"收藏"})]})]}),n.jsx("button",{type:"button",className:"ml-close",onClick:()=>te(!1),"aria-label":"關閉清單",children:"×"})]}),n.jsx("div",{className:"ml-list-moods",children:it.map(e=>n.jsx("button",{type:"button",className:q===e.id?"active":"",onClick:()=>Se(e.id),children:e.label},`list-mood-${e.id}`))}),n.jsx("div",{className:"ml-list-body",children:Be.length?Be.map(e=>n.jsxs("article",{className:"ml-list-item",role:"button",tabIndex:0,onClick:()=>De(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),De(e))},children:[n.jsxs("span",{className:"ml-list-item-main",children:[n.jsx("span",{className:"ml-list-title",children:e.title}),n.jsx("span",{className:"ml-list-mood",children:e.primaryMoodLabel})]}),n.jsx("button",{type:"button",className:"ml-list-star","aria-label":P.has(e.id)?"取消收藏":"加入收藏",onClick:t=>{t.stopPropagation(),Oe(e.id)},children:P.has(e.id)?"★":"☆"})]},e.id)):n.jsx("p",{className:"ml-list-empty",children:"這裡還沒有符合條件的信件。"})})]})}),n.jsx("section",{className:`ml-settings-overlay ${tt?"open":""}`,onClick:Xe,children:n.jsxs("article",{className:"ml-settings-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-settings-head",children:[n.jsx("h3",{children:"心情星球小設定"}),n.jsx("button",{type:"button",className:"ml-close ml-settings-close",onClick:Xe,"aria-label":"關閉設定",children:"×"})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("div",{className:"ml-setting-row",children:[n.jsx("span",{children:"M"}),n.jsx("button",{type:"button",className:`ml-switch ${c.showChibi?"on":""}`,onClick:()=>F(e=>({...e,showChibi:!e.showChibi})),children:n.jsx("span",{})})]}),n.jsxs("label",{className:"ml-setting-label",children:["大小",n.jsx("input",{type:"range",min:104,max:196,step:1,value:c.chibiWidth,onChange:e=>F(t=>({...t,chibiWidth:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球數（",c.orbCount," 顆）",n.jsx("input",{type:"range",min:Ze,max:Ge,step:1,value:c.orbCount,onChange:e=>F(t=>({...t,orbCount:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球速（",c.orbSpeed.toFixed(2),"x）",n.jsx("input",{type:"range",min:.7,max:2.4,step:.01,value:c.orbSpeed,onChange:e=>F(t=>({...t,orbSpeed:Number(e.target.value)}))})]}),n.jsxs("div",{className:"ml-setting-label",children:[n.jsx("span",{children:"球球模式"}),n.jsx("div",{className:"ml-orb-mode-options",role:"radiogroup","aria-label":"球球模式",children:xt.map(e=>n.jsx("button",{type:"button",role:"radio","aria-checked":c.orbMode===e.id,className:`ml-orb-mode-btn ${c.orbMode===e.id?"active":""}`,onClick:()=>F(t=>({...t,orbMode:e.id})),children:e.label},e.id))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("label",{className:"ml-setting-label",children:["文字大小（",c.contentFontSize.toFixed(1),"px）",n.jsx("input",{type:"range",min:12,max:24,step:.1,value:c.contentFontSize,onChange:e=>F(t=>({...t,contentFontSize:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["行距（",c.contentLineHeight.toFixed(2),"）",n.jsx("input",{type:"range",min:1.35,max:2.9,step:.01,value:c.contentLineHeight,onChange:e=>F(t=>({...t,contentLineHeight:Number(e.target.value)}))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsx("p",{className:"ml-setting-caption",children:"紙張色票"}),n.jsx("div",{className:"ml-paper-themes",children:Object.keys(de).map(e=>{const t=de[e];return n.jsx("button",{type:"button",className:`ml-paper-chip ${c.paperTheme===e?"active":""}`,style:{"--chip-bg":t.paperBg,"--chip-accent":t.accentColor,"--chip-text":t.titleColor},onClick:()=>F(o=>({...o,paperTheme:e})),children:t.label},e)})})]})]})})]})}export{$t as MoodLettersPage,$t as default};
